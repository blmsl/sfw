<div fxLayout.gt-sm="row"
     fxLayout="column"
     *ngIf="seasons$ | async as seasons; else loadingTemplate">

    <mat-card fxFlex.gt-sm="33,3333">
        <mat-card-title>
            {{'general.members.edit.assignedAsPlayer' | translate}}
        </mat-card-title>
        <mat-card-subtitle></mat-card-subtitle>
        <mat-card-content>

            <p *ngIf="(teams | isTeamMemberFilter : member : 'assignedPlayers').length === 0">
                {{'general.members.edit.notAssignedToAnyTeams' | translate}}
            </p>

            <div *ngIf="(teams | isTeamMemberFilter : member : 'assignedPlayers').length !== 0">
                <div *ngFor="let season of seasons | seasonsWithTeamsFilter: (teams | isTeamMemberFilter : member : 'assignedPlayers')">
                    <h3>{{season.title}}</h3>

                    <mat-list dense *ngIf="(teams | isTeamMemberFilter : member : 'assignedPlayers'
                    | orderBy: ['subTitle', 'title'] | filterBy: ['assignedSeason'] : season.id).length > 0">

                        <mat-list-item *ngFor="let team of teams | isTeamMemberFilter : member : 'assignedPlayers'
                                | orderBy: ['subTitle', 'title'] | filterBy: ['assignedSeason'] : season.id">
                            <a [routerLink]="['/teams/detail', team.id]">{{team.title}} {{team.subTitle}}</a>
                            <span fxFlex></span>
                            <button mat-icon-button
                                    (click)="deleteMemberFromTeam.emit({team: team, member: member})">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </mat-list-item>

                    </mat-list>
                </div>
            </div>

        </mat-card-content>
    </mat-card>


    <mat-card fxFlex.gt-sm="33,3333">
        <mat-card-title>
            {{'general.members.detail.functions.inTeamManagement' | translate}}
        </mat-card-title>
        <mat-card-subtitle></mat-card-subtitle>
        <mat-card-content>

            <p *ngIf="(teams | isTeamManagementFilter : member).length === 0">
                {{'general.members.edit.notAssignedToAnyTeamManagements' | translate}}
            </p>

            <div *ngIf="(teams | isTeamManagementFilter : member).length !== 0">
                <div *ngFor="let season of seasons | seasonsWithTeamsFilter: (teams | isTeamManagementFilter : member)">
                    <h3>{{season.title}}</h3>

                    <mat-list dense
                              *ngIf="(teams | isTeamManagementFilter : member | orderBy: ['subTitle', 'title'] | filterBy: ['assignedSeason'] : season.id).length > 0">
                        <mat-list-item
                                *ngFor="let team of teams | isTeamManagementFilter : member | orderBy: ['subTitle', 'title'] | filterBy: ['assignedSeason'] : season.id">
                            <a [routerLink]="['/teams/detail', team.id]">{{team.title}} {{team.subTitle}}</a>
                            <span fxFlex></span>
                            <span *ngFor="let position of team.assignedPositions | filterBy: ['assignedMember'] : member.id; let last = last">{{position.position}}
                                <span *ngIf="!last">, </span>
                            </span>
                            <span fxFlex></span>
                            <button mat-icon-button
                                    (click)="deleteMemberFromTeamManagement.emit({team: team, member: member})">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </mat-list-item>
                    </mat-list>
                </div>
            </div>

        </mat-card-content>
    </mat-card>


    <mat-card fxFlex.gt-sm="33,3333">
        <mat-card-title>
            {{'general.members.detail.functions.inClubManagement' | translate}}
        </mat-card-title>
        <mat-card-subtitle></mat-card-subtitle>
        <mat-card-content>

            <p *ngIf="(clubs | isMemberInClubManagementFilter: member).length === 0">
                {{'general.members.detail.functions.noClubManagementPositions' | translate}}
            </p>

            <div *ngIf="categories$ | async as categories; else loadingTemplate">
                <div *ngFor="let club of clubs | isMemberInClubManagementFilter: member">
                    <h3>{{club.title}}</h3>
                    <mat-list *ngIf="club.management && club.management.positions"
                              dense>
                        <mat-list-item *ngFor="let position of club.management.positions">
                            <span *ngIf="position.assignedMember === member.id">
                                <a [routerLink]="['/categories/detail', position.assignedPosition]">
                                    {{(categories | filterBy: ['id'] :position.assignedPosition)[0].title}}
                                </a>
                            </span>
                            <span fxFlex=""></span>
                            <div>
                                <span *ngIf="!position.endDate">{{'general.since' | translate}}</span>
                                <span *ngIf="position.endDate">{{'general.from' | translate}}</span>
                                {{position.startDate.seconds *1000 | date: 'dd.MM.yy'}}
                                {{position.endDate ? (' bis ' + position.endDate.seconds *1000 | date: 'dd.MM.yy') : ''}}
                            </div>
                        </mat-list-item>
                    </mat-list>
                </div>
            </div>
        </mat-card-content>
    </mat-card>

</div>

<ng-template #loadingTemplate>
    <loading-indicator></loading-indicator>
</ng-template>

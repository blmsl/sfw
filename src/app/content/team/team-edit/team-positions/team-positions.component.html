<div fxLayout.gt-sm="row"
     fxLayout="column"
     fxLayoutGap="10px"
     [formGroup]="form"
     *ngIf="members; else loadingTemplate">

  <div fxFlex.gt-sm="30">
    <mat-card>
      <mat-card-title>{{'general.teams.edit.position.players' | translate}}</mat-card-title>
      <mat-card-subtitle></mat-card-subtitle>
      <hr/>
      <mat-card-content fxLayout="column">
        <p *ngIf="!members.length">{{'general.teams.edit.position.noMembers' | translate}}</p>

        <mat-form-field fxFlex="100"
                        *ngIf="members.length">
          <mat-select placeholder="{{'general.teams.edit.position.players' | translate}}"
                      formControlName="assignedPlayers"
                      multiple>
            <mat-option
              *ngFor="let member of members | orderBy: ['mainData.lastName', 'mainData.firstName', 'mainData.birthday']"
              [value]="member.id">
              {{member.mainData.lastName}}
              {{member.mainData.firstName}}
              {{ member.mainData.birthday | date: 'dd.MM.yy'}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-list dense fxFlex="100">
          <mat-list-item *ngFor="let memberId of form.get('assignedPlayers').value">
                    <span mat-line>
                        {{ (members | filterBy: ['id'] : memberId)[0].mainData.lastName }}
                        {{ (members | filterBy: ['id'] : memberId)[0].mainData.firstName }}
                        {{ (members | filterBy: ['id'] : memberId)[0].mainData.birthday | date: 'dd.MM.yy' }}
                    </span>
            <button mat-icon-button (click)="deleteFromTeam(memberId)">
              <mat-icon>delete</mat-icon>
            </button>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex.gt-sm="70">
    <mat-card>
      <mat-card-title>{{'general.teams.edit.position.managements' | translate}}</mat-card-title>
      <mat-card-subtitle>{{'general.teams.edit.position.description' | translate}}</mat-card-subtitle>
      <hr/>
      <mat-card-content>
        <div *ngIf="categories && categoryTypes.length > 0">

          <p *ngIf="!form.controls['assignedPositions']">{{'general.teams.edit.position.noPosition' | translate}}</p>
          <p *ngIf="!members.length">{{'general.teams.edit.position.noMembers' | translate}}</p>
          <p *ngIf="(categories | filterBy: ['assignedCategoryType']: categoryTypes[0].id).length === 0">
            {{'general.teams.edit.position.noPositionsDefined' | translate}}
          </p>
          <p *ngIf="categoryTypes.length === 0">{{'general.teams.edit.position.noCategoryTypesDefined' | translate}}</p>

          <div
            *ngIf="members.length && (categories | filterBy: ['assignedCategoryType']: categoryTypes[0].id).length > 0"
            formArrayName="assignedPositions">
            <div *ngFor="let position of form.controls['assignedPositions']['controls']; let i=index">
              <div [formGroupName]="i"
                   fxFlex="100">
                <team-position-form (removePosition)="removePosition.emit($event)"
                                    [categories]="categories | filterBy: ['assignedCategoryType']: categoryTypes[0].id"
                                    [members]="members"
                                    [i]="i"
                                    [form]="form.controls['assignedPositions']['controls'][i]">
                </team-position-form>
              </div>
            </div>
          </div>
        </div>

      </mat-card-content>
      <mat-card-actions *ngIf="categories && categoryTypes.length > 0">
        <div fxLayout="column"
             fxLayout.gt-sm="row"
             fxLayoutGap="10px">
          <span></span>
          <span fxFlex=""></span>
          <button mat-raised-button
                  type="button"
                  color="primary"
                  (click)="addPosition.emit(true)">
            {{ 'general.teams.edit.position.add' | translate}}
          </button>
        </div>
      </mat-card-actions>
    </mat-card>
  </div>

</div>

<ng-template #loadingTemplate>
  <loading-indicator></loading-indicator>
</ng-template>
